# Extract_internal_tides_with_UNet_and_surface_field_synergy
Prodution codes for our paper "Disentangling Internal Tides from Balanced Motions with Deep Learning and Surface Field Synergy" by Han Wang, Jeffrey Uncu, Kaushik Srinivasan and Nicolas Grisouard. 

--Folder “U_Net_training_and_definitions” contains the main codes defining and training the U-Nets used in the paper. 
- The file unet.py contains the definition for our main U-Net. (The one without batchnorm is what we call in the main codes.) It calls functions in unet_parts.py and utils.py. 
- All the Jupyter Notebook files by default contain some outputs (e.g., mean correlation averaged over the test set as the training progresses) reported in our paper, and by inspecting the default form without running anything, you can have a good idea what we do exactly.  To run the notebooks yourself, you need to have already downloaded the training/testing data from https://borealisdata.ca/dataset.xhtml?persistentId=doi:10.5683/SP2/HU58SG , and keep the data in a path accessible to the Jupyter NOtebooks. You may need to change the path to the data and to the directory where you save the checkpoints, according to where you prefer them to be.  
- The files starting with "anyinput_to_anyoutput_nobatchnorm_" are what we use to train the U-Nets, i.e., 10 re-trained U-Nets for each input configuration. They generate the checkpoint files for each experiment. 
- Files starting with "hw_save" take one trained U-Net (in the form of a checkpoint) from each configuration, apply it to all the testing data, and save them to some folder.  You may want to change the path where you save the generated data to your liking. They use the checkpoint files generated by the files starting with "anyinput_to_anyoutput_nobatchnorm_"; due to the limit of file sizes, I do not upload the training checkpoint files; if you run those notebooks, the checkpoint files will be generated. 
- Files starting with "hw_compare_10_retrains" compare the outputs from 10 re-trained U-Nets for each experiment.
- Files starting with "hw_vortdiv_" are juptyter files where we experimented with the configurations where vorticity and divergence are inputs. They give some confusing outcomes, as detailed in the Discussion and Supporting Information Text S5 of the paper.
- File "OnelayerUNet_nobatchnorm" is the notebook where we attempt to train a very shallow U-Net with only one encoding/decoding layer. We can't run this because of memory constraint; this is mentioned in section 3.5 "Non-locality" in our paper.
- Files "ShallowUNet_nobatchnorm" and "TwolayerUNet_nobatchnorm" contain the definition and the main training code (in Jupyter Notebook) for the two-layer U-Net, discussed in section 3.5 "Non-locality" in our paper.

--Folder "analysis_and_plotting" contains all the production codes we use to generate figures in the paper, as well as some quantitative analysis of the output figures. They use the data generated during testing, produced by the files starting with "hw_save" in the folder “U_Net_training_and_definitions” (see above for the file descriptions). Due to the limit of file sizes, I do not upload the generated data during testing; if you run those codes, the data should be generated.
